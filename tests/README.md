# SmartClip Tests

## Запуск тестов

### Сборка и запуск всех тестов
```bash
mkdir build
cd build
cmake ..
make
ctest
```

### Запуск конкретного теста
```bash
./tests/SettingsDialogTest
./tests/HistoryManagerTest
./tests/LaunchAgentManagerTest
./tests/SmartClipAppTest
```

### Использование Makefile
```bash
# Обычный запуск всех тестов
make test QT_PATH=/path/to/Qt/6.x.x

# Запуск с детализацией
make test-verbose QT_PATH=/path/to/Qt/6.x.x
```

## Структура тестов

- `SettingsDialogTest.cpp` - юнит-тесты для класса SettingsDialog
- `HistoryManagerTest.cpp` - юнит-тесты для класса HistoryManager  
- `LaunchAgentManagerTest.cpp` - юнит-тесты для класса LaunchAgentManager
- `SmartClipAppTest.cpp` - юнит-тесты для класса SmartClipApp
- `CMakeLists.txt` - конфигурация сборки тестов

## Покрытие тестов

### SettingsDialog (10 тестов)
- **Инициализация диалога** - проверка создания и базовых свойств
- **Загрузка настроек** - корректное отображение текущих настроек в UI
- **Валидация данных** - проверка корректности входных значений
- **Сохранение настроек** - проверка сохранения настроек при подтверждении
- **Обработка отмены** - проверка корректной обработки отмены диалога
- **Настройка UI** - проверка правильной инициализации элементов интерфейса

### HistoryManager (17 тестов)
- **Инициализация** - проверка начального состояния
- **Управление историей** - добавление, удаление, очистка
- **Ограничения** - проверка максимального количества элементов
- **Избранное** - добавление/удаление из избранного
- **Счетчик использования** - инкремент счетчика
- **Сортировка** - проверка порядка сортировки (избранные → популярные → новые)
- **Сохранение/загрузка** - работа с файлами
- **Обработка ошибок** - некорректные файлы, отсутствующие файлы

### LaunchAgentManager (7 тестов)
- **Инициализация** - проверка создания менеджера
- **Включение автозапуска** - создание plist файла и загрузка в launchctl
- **Отключение автозапуска** - выгрузка и удаление plist файла
- **Обработка существующего файла** - корректное удаление при отключении
- **Кроссплатформенность** - работа на non-Mac платформах
- **Обработка ошибок launchctl** - игнорирование ошибок системных вызовов

### SmartClipApp (21 тест)
- **Инициализация приложения** - проверка создания и базовых настроек
- **Системный трей** - отображение и работа иконки
- **Буфер обмена** - отслеживание изменений, обработка дубликатов
- **Меню приложения** - построение, обновление, обработка действий
- **Избранное** - управление цветами, переключение статуса
- **Настройки** - открытие диалога, применение изменений
- **Очистка истории** - удаление всех элементов
- **Выход из приложения** - корректное сохранение и очистка
- **Файловые операции** - пути к файлам настроек и истории
- **Платформо-зависимый функционал** - опрос буфера обмена на macOS
- **Обработка ошибок** - отсутствующие иконки, системные вызовы

## Краевые случаи:

### SettingsDialog:
- Работа с нулевым указателем на SettingsManager
- Некорректные значения (0, >1000) для maxItems
- Проверка сигналов `settingsChanged()`

### HistoryManager:
- Пустые и пробельные строки
- Дублирующиеся элементы
- Несуществующие файлы
- Поврежденные файлы
- Превышение лимита элементов

### LaunchAgentManager:
- Отсутствие прав для системных вызовов launchctl
- Несуществующие директории LaunchAgents
- Платформо-зависимый код (macOS vs другие)

### SmartClipApp:
- Отсутствие ресурсов (иконки) в тестовой среде
- Пустые и дублирующиеся изменения буфера обмена
- Быстрые изменения буфера обмена
- Отсутствие системного трея в тестовой среде
- Платформо-зависимый функционал (macOS)

## Детализация запуска

Для просмотра детальной информации по каждому тесту:
```bash
# Через CTest
cd build && ctest --verbose

# Напрямую через QtTest
./tests/SettingsDialogTest -v2
./tests/HistoryManagerTest -v2
./tests/LaunchAgentManagerTest -v2
./tests/SmartClipAppTest -v2

# Через Makefile
make test-verbose QT_PATH=/path/to/Qt/6.x.x
```
